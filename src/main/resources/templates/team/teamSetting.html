<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>팀 관리</title>
  <link rel="stylesheet" href="/static/css/reset.css" />
  <link rel="stylesheet" href="/static/css/teamSetting.css" />
  <link rel="stylesheet" href="/static/css/m-teamSetting.css" />
  <script
          src="https://code.jquery.com/jquery-3.6.1.min.js"
          integrity="sha256-o88AwQnZB+VDvE9tvIXrMQaPlFFSUTR+nldQm1LuPXQ="
          crossorigin="anonymous"
  ></script>
  <script src="/static/js/jQueryCheck.js"></script>
</head>
<body>
<div class="wrap">
  <h1 class="title">팀 관리</h1>
  <div class="contentWrap">
    <div class="teamProfile">
      <p class="subTitle">팀 프로필</p>
        <div class="article">
          <input
                  type="text"
                  name="teamName"
                  id="teamName"
                  class="input_text"
                  th:value="${teamDto.getTeamName()}"
                  disabled
          />
          <input type="hidden" id="teamSeqHidden" th:value="${teamDto.getTeamSeq()}">
          <div id="updateDiv">
          <button type="button" id="changeTeam" class="editBtn">
            변경
          </button>
          </div>
        </div>
    </div>

    <div class="memberProfile">
      <p class="subTitle">멤버 관리</p>
      <div th:if="${teamMemberDtoList!=null}">
        <th:block th:each="teamMemberDtoList : ${teamMemberDtoList}">
        <div class="article">
          <div class="metaData">
            <img src="" alt="" class="profileImg" />
            <div class="texts">
              <input
                      type="text"
                      name="memberName"
                      id="memberName"
                      class="inputText"
                      th:value="${teamMemberDtoList.teamMemberNickname}"
                      readonly
              />
              <input
                      type="text"
                      name="memberEmail"
                      id="memberEmail"
                      class="inputEmail"
                      th:value="${teamMemberDtoList.memberId}"
                      readonly
              />
            </div>
          </div>
          <div class="btns">
            <button
                    type="button"
                    name="grade"
                    id="grade"
                    class="gradeBtn"
                    onclick="opener(this)"
                    th:seq="${teamMemberDtoList.memberSeq}"
            >
              등급
            </button>
            <button type="submit" class="editBtn" id="eidtMember">
              변경
            </button>
            <button type="submit" class="delBtn" id="delMember">
              강퇴
            </button>
          </div>
        </div>
        </th:block>
      </div>
    </div>
  </div>
    <div class="modal">
      <div class="modalWrap">
        <h1>🤔</h1>
        <h3>
          member 님의 등급을 <br />
          어떻게 변경할까요?
        </h3>
        <button id="master" class="modalBtn" onclick="changer(this)">
          마스터
        </button>
        <button id="manager" class="modalBtn" onclick="changer(this)">
          매니저
        </button>
        <button
                id="staff"
                type="button"
                class="modalBtn"
                onclick="changer(this)"
        >
          팀원
        </button>
        <button id="goBack" type="button" onclick="closer()">나가기</button>
      </div>
    </div>

  <form action="/team/deleteTeam" id="deleteTeam" method="post">
    <input type="hidden" name="teamSeq" id="teamSeq" th:value="${teamDto.getTeamSeq()}">
  <p style="text-align: center; margin-top: 20px;">팀을 삭제하시겠습니까? <a href="#" onclick="delClick()"><strong>삭제</strong></a></p>
  </form>
</div>
<script>
  var modal = document.querySelector(".modal");
  var grade = document.querySelector("#grade");
  var gradeBtn = document.querySelector(".gradeBtn");
  var modalBtn = document.querySelectorAll(".modalBtn");
  var master = document.querySelector("#master");
  var manager = document.querySelector("#manager");
  var staff = document.querySelector("#staff");
  var choice = $(".staff").html();
  // modal 열림 함수
  function closer() {
    modal.style.display = "none";
  }
  // modal 닫힘 함수
  function opener() {
    modal.style.display = "block";
  }
  // 등급 선택시 이벤트 행동
  function changer(e) {
    grade.innerText = e.innerText;
    modal.style.display = "none";
  }

 // 팀 삭제 시 경고메세지
function delClick() {
  if (confirm("팀을 정말 삭제 하시겠습니까?")) {
    $("#deleteTeam").submit();
    alert("팀이 삭제 되었습니다");
    return true;
  } else {
    alert("잘 생각하셨어요!");
    return false;
  }
}

</script>

<script>
  //팀 이름 변경
  let updateTeamNameBtn = $("<button>");
  updateTeamNameBtn.text("완료");
  updateTeamNameBtn.attr("type", "button");
  updateTeamNameBtn.attr("id", "updateTeamNameBtn");
  updateTeamNameBtn.attr("class","editBtn");

  $("#changeTeam").on("click",function (){
    $("#teamName").attr("disabled", false);
    $("#changeTeam").css("display","none");
    $("#teamName").css("border","2px dashed magenta");
    $('#updateDiv').append(updateTeamNameBtn);
  })

  updateTeamNameBtn.on("click",function () {
    let teamName = $("#teamName").val();
    let teamSeq = $("#teamSeqHidden").val();
    $.ajax({
      url: "/team/updateTeamName",
      data: {
        "teamName": teamName,
        "teamSeq": teamSeq
      },
      success: function () {
      }, error: function () {
      }
    }).done(function () {
      alert("팀 이름이 변경되었습니다.");
      $("#teamName").val(teamName);
      $("#teamName").attr("disabled", true);
      $("#changeTeam").css("display","block");
      updateTeamNameBtn.css("display","none");
      $("#teamName").css("border", "none");
    })
  })
</script>

</body>
</html>
